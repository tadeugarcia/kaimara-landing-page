"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.updatePriceListsWorkflow = exports.updatePriceListsWorkflowId = void 0;
const workflows_sdk_1 = require("@medusajs/workflows-sdk");
const steps_1 = require("../steps");
exports.updatePriceListsWorkflowId = "update-price-lists";
exports.updatePriceListsWorkflow = (0, workflows_sdk_1.createWorkflow)(exports.updatePriceListsWorkflowId, (input) => {
    const [priceListsMap, variantPriceMap] = (0, workflows_sdk_1.parallelize)((0, steps_1.validatePriceListsStep)(input.price_lists_data), (0, steps_1.validateVariantPriceLinksStep)(input.price_lists_data));
    const getPriceListPricesInput = (0, workflows_sdk_1.transform)({ priceListsMap }, (data) => ({
        price_list_ids: Object.keys(data.priceListsMap),
    }));
    const priceListPriceIdMap = (0, steps_1.getExistingPriceListsPriceIdsStep)(getPriceListPricesInput);
    const removePriceListPricesInput = (0, workflows_sdk_1.transform)({ priceListPriceIdMap }, (data) => Object.values(data.priceListPriceIdMap).flat(1));
    (0, steps_1.removePriceListPricesStep)(removePriceListPricesInput);
    const updatePricesInput = (0, workflows_sdk_1.transform)({ variantPriceMap, input }, (data) => ({
        data: data.input.price_lists_data,
        variant_price_map: data.variantPriceMap,
    }));
    (0, steps_1.createPriceListPricesStep)(updatePricesInput);
    const updatePriceListInput = (0, workflows_sdk_1.transform)({ input }, (data) => {
        return data.input.price_lists_data.map((priceListData) => {
            delete priceListData.prices;
            return priceListData;
        });
    });
    (0, steps_1.updatePriceListsStep)(updatePriceListInput);
});
